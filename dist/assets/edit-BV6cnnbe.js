import{a as V}from"./crontab-D56oAgVs.js";import{k as i,fs as T,S as F,r as d,o as L,h as M,w as u,d as t,e as O,K as P,M as S}from"./index-oR0mlNqp.js";const N={__name:"edit",emits:["success"],setup(E,{expose:_,emit:b}){const g=b,f=i(),p=i(""),m=i(!1),c=i(!1);let k=T(()=>"定时任务"+(p.value=="add"?"-新增":"-编辑"));const y=[{label:"URL任务GET",value:1},{label:"URL任务POST",value:2},{label:"类任务",value:3}],a=F({id:"",name:"",type:"",rule:"",target:"",parameter:"",status:1,remark:""}),U={name:[{required:!0,message:"任务名称不能为空"}],type:[{required:!0,message:"任务类型不能为空"}],rule:[{required:!0,message:"定时规则不能为空"}],target:[{required:!0,message:"调用目标不能为空"}]},w=async(s="add")=>{p.value=s,m.value=!0,f.value.resetFields(),await x()},x=async()=>{},q=async s=>{for(const e in a)s[e]!=null&&s[e]!=null&&(a[e]=s[e])},C=async s=>{var r;if(!await((r=f.value)==null?void 0:r.validate())){c.value=!0;let o={...a},n={};p.value==="add"?(o.id=void 0,n=await V.save(o)):n=await V.update(o.id,o),n.code===200&&(S.success("操作成功"),g("success"),s(!0)),setTimeout(()=>{c.value=!1},500)}s(!1)},R=()=>m.value=!1;return _({open:w,setFormData:q}),(s,e)=>{const r=d("a-input"),o=d("a-form-item"),n=d("a-select"),v=d("a-textarea"),B=d("sa-radio"),D=d("a-form");return L(),M(P("a-modal"),{visible:m.value,"onUpdate:visible":e[7]||(e[7]=l=>m.value=l),width:600,title:O(k),"mask-closable":!1,"ok-loading":c.value,onCancel:R,onBeforeOk:C},{default:u(()=>[t(D,{ref_key:"formRef",ref:f,model:a,rules:U,"auto-label-width":!0},{default:u(()=>[t(o,{label:"任务名称",field:"name"},{default:u(()=>[t(r,{modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.name=l),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),t(o,{label:"任务类型",field:"type"},{default:u(()=>[t(n,{modelValue:a.type,"onUpdate:modelValue":e[1]||(e[1]=l=>a.type=l),options:y,placeholder:"请选择任务类型"},null,8,["modelValue"])]),_:1}),t(o,{label:"定时规则",field:"rule",extra:"例如：30 */5 * * * *，代表每隔5分钟的第30秒执行任务"},{default:u(()=>[t(r,{modelValue:a.rule,"onUpdate:modelValue":e[2]||(e[2]=l=>a.rule=l),placeholder:"请输入定时规则"},null,8,["modelValue"])]),_:1}),t(o,{label:"调用目标",field:"target"},{default:u(()=>[t(v,{modelValue:a.target,"onUpdate:modelValue":e[3]||(e[3]=l=>a.target=l),placeholder:"请输入调用目标"},null,8,["modelValue"])]),_:1}),t(o,{label:"任务参数",field:"parameter"},{default:u(()=>[t(v,{modelValue:a.parameter,"onUpdate:modelValue":e[4]||(e[4]=l=>a.parameter=l),placeholder:"请输入任务参数"},null,8,["modelValue"])]),_:1}),t(o,{label:"状态",field:"status"},{default:u(()=>[t(B,{modelValue:a.status,"onUpdate:modelValue":e[5]||(e[5]=l=>a.status=l),dict:"data_status",placeholder:"请选择状态"},null,8,["modelValue"])]),_:1}),t(o,{label:"备注",field:"remark"},{default:u(()=>[t(v,{modelValue:a.remark,"onUpdate:modelValue":e[6]||(e[6]=l=>a.remark=l),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},40,["visible","title","ok-loading"])}}};export{N as default};
