import{k as d,fs as J,S as A,M as c,A as W,r as a,o as _,c as H,d as o,J as K,e as w,w as t,f as s,h as m,ft as Q,q as X}from"./index-oR0mlNqp.js";import{a as r}from"./generate-Db7nyP4X.js";import Y from"./loadTable-B8hqH8LV.js";import Z from"./preview-DnuIIwTm.js";import ee from"./editInfo-BstAwqn1.js";import"./dataMaintain-BO0hPD53.js";import"./menu-DzJnGZEV.js";import"./dict-DHz__nwp.js";import"./settingComponent-BiI2KsG-.js";const te={class:"ma-content-block"},_e={__name:"index",setup(oe){const i=d(),b=d(),x=d(),C=d(),y=d([]),B=n=>y.value=n,D=async(n,e)=>{if(n==="generateCode"){R(e);return}if(n==="generateFile"){Q.info({title:"提示",content:"生成到项目将会覆盖原有文件，确定要生成吗？",simple:!1,onBeforeOk:f=>{E(e),f(!0)}});return}},R=async n=>{c.info("代码生成下载中，请稍后");const e=await r.generateCode({ids:n.toString().split(",")});e?(X.download(e,"saiadmin.zip"),c.success("代码生成成功，开始下载")):c.error("文件下载失败")},M=async n=>{const e=await r.sync(n);e.code===200&&c.success(e.message)},E=async n=>{const e=await r.generateFile({id:n});e.code===200&&c.success(e.message)},O=()=>{if(y.value.length===0){c.error("至少要选择一条数据");return}R(y.value.join(","))},u=d({table_name:"",source:""});let g=J(()=>i.value?i.value.isRecovery:!1);const T=A({pk:"id",api:r.getPageList,recycleApi:r.getRecyclePageList,pageLayout:"fixed",rowSelection:{showCheckedAll:!0},operationColumn:!0,operationColumnWidth:300,edit:{show:!0,func:async n=>{b.value.open(n.id)}},delete:{show:!0,func:async n=>{var e;await r.deletes(n),c.success("删除成功！"),(e=i.value)==null||e.refresh()},realAuth:["/core/menu/realDestroy"],realFunc:async n=>{var e;await r.realDestroy(n),c.success("销毁成功！"),(e=i.value)==null||e.refresh()}},recovery:{show:!0,func:async n=>{var e;await r.recoverys(n),c.success("恢复成功！"),(e=i.value)==null||e.refresh()}}}),U=A([{title:"表名称",dataIndex:"table_name",width:180,align:"left"},{title:"表描述",dataIndex:"table_comment",width:150,align:"left"},{title:"应用类型",dataIndex:"template",width:120},{title:"应用名称",dataIndex:"namespace",width:120},{title:"模板类型",dataIndex:"stub",width:120},{title:"生成类型",dataIndex:"tpl_category",width:120},{title:"创建时间",dataIndex:"create_time",width:180}]),v=async()=>{var n;(n=i.value)==null||n.refresh()};return W(async()=>{v()}),(n,e)=>{const f=a("a-input"),S=a("a-form-item"),F=a("a-col"),L=a("icon-code"),I=a("a-button"),P=a("icon-export"),$=a("icon-eye"),h=a("a-link"),N=a("icon-sync"),j=a("a-popconfirm"),q=a("icon-double-right"),V=a("a-doption"),z=a("a-dropdown"),p=a("a-tag"),G=a("sa-table");return _(),H("div",te,[o(G,{ref_key:"crudRef",ref:i,options:T,columns:U,searchForm:u.value,onSelectionChange:B},K({tableSearch:t(()=>[o(F,{span:8},{default:t(()=>[o(S,{field:"table_name",label:"表名称"},{default:t(()=>[o(f,{modelValue:u.value.table_name,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value.table_name=l),placeholder:"请输入数据表名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(F,{span:8},{default:t(()=>[o(S,{field:"source",label:"数据源"},{default:t(()=>[o(f,{modelValue:u.value.source,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value.source=l),placeholder:"请输入数据源名称"},null,8,["modelValue"])]),_:1})]),_:1})]),tpl_category:t(({record:l})=>[l.tpl_category=="single"?(_(),m(p,{key:0,color:"green"},{default:t(()=>[s("单表CRUD")]),_:1})):(_(),m(p,{key:1,color:"red"},{default:t(()=>[s("树表CRUD")]),_:1}))]),form_type:t(({record:l})=>[l.form_type=="a-modal"?(_(),m(p,{key:0,color:"blue"},{default:t(()=>[s("Modal")]),_:1})):(_(),m(p,{key:1,color:"orange"},{default:t(()=>[s("Drawer")]),_:1}))]),_:2},[w(g)?void 0:{name:"tableAfterButtons",fn:t(()=>[o(I,{type:"outline",onClick:O},{icon:t(()=>[o(L)]),default:t(()=>[s("生成代码 ")]),_:1}),o(I,{onClick:e[2]||(e[2]=()=>C.value.open()),type:"outline",status:"success"},{icon:t(()=>[o(P)]),default:t(()=>[s("装载数据表 ")]),_:1})]),key:"0"},w(g)?void 0:{name:"operationBeforeExtend",fn:t(({record:l})=>[o(h,{onClick:k=>x.value.open(l.id)},{default:t(()=>[o($),s(" 预览")]),_:2},1032,["onClick"]),o(j,{content:"同步会自动同步数据库字段，确定同步吗?",position:"bottom",onOk:k=>M(l.id)},{default:t(()=>[o(h,null,{default:t(()=>[o(N),s(" 同步")]),_:1})]),_:2},1032,["onOk"])]),key:"1"},w(g)?void 0:{name:"operationAfterExtend",fn:t(({record:l})=>[o(z,{trigger:"hover",onSelect:k=>D(k,l.id)},{content:t(()=>[o(V,{value:"generateFile"},{default:t(()=>[s("生成到项目")]),_:1}),o(V,{value:"generateCode"},{default:t(()=>[s("代码下载")]),_:1})]),default:t(()=>[o(h,null,{default:t(()=>[o(q),s(" 生成")]),_:1})]),_:2},1032,["onSelect"])]),key:"2"}]),1032,["options","columns","searchForm"]),o(Y,{ref_key:"loadTableRef",ref:C,onSuccess:v},null,512),o(Z,{ref_key:"previewRef",ref:x},null,512),o(ee,{ref_key:"editRef",ref:b,onSuccess:v},null,512)])}}};export{_e as default};
