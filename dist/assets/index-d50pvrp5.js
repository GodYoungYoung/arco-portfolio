import{k as r,A as re,r as n,fu as pe,o as d,c as E,l as p,d as u,w as t,L as x,h as c,F as S,g as j,f as g,t as U,i as v,N as _e,M as k,fv as fe}from"./index-oR0mlNqp.js";import{c as V}from"./config-DGlCJYQb.js";import ve from"./add-group-BwwGIA8z.js";import ye from"./manage-config-a-k3FL4z.js";import"./edit-DS3qt2sz.js";const me={class:"ma-content-block lg:flex justify-between"},ge={class:"lg:w-3/12 w-full h-full p-4 pr-2"},ke={class:"flex justify-between items-center",style:{height:"30px"}},xe=p("span",null,"配置分组",-1),Ve={class:"flex justify-between items-center"},he={class:"flex"},Ce={class:"lg:w-9/12 w-full p-4 pl-2"},we={class:"pl-4 pr-4"},be={class:"mb-2"},Oe={class:"text-red-500 underline font-black"},Ue={class:"text-red-500"},qe={__name:"index",setup(Ge){const L=r(),h=r(),A=r({}),_=r([]),C=r([]),G=r(!1),$=r(""),z=r(""),y=r({name:""}),D=r(!1),f=r({}),w=r(""),T=async()=>{N(f.value.id,f.value.name,f.value.code)},I=async l=>{if(z.value!==y.value.name){k.error("输入错误，验证失败"),l(!1);return}(await V.deleteConfigGroup({ids:y.value.id})).code===200&&(k.success("配置删除成功"),y.value={},M(),l(!0))},H=l=>{const o=l.id;if(o==1||o==2){k.info("该配置为系统核心配置，无法删除");return}y.value=C.value.find(a=>a.id==o),D.value=!0},M=async()=>{const l=await V.getConfigGroupList();C.value=l.data;const o=C.value[0];await N(o.id,o.name,o.code)},N=async(l,o,a)=>{f.value.id=l,f.value.name=o,f.value.code=a,G.value=!0;const m={group_id:l,orderBy:"sort",orderType:"desc"};$.value=o;const b=await V.getConfigList(m);b.data.map(i=>(i.key.indexOf("local_")!==-1||i.key.indexOf("qiniu_")!==-1||i.key.indexOf("cos_")!==-1||i.key.indexOf("oss_")!==-1?i.display=!1:i.display=!0,i)),_.value=b.data,l===2&&_.value.map(i=>{i.key==="upload_mode"&&F(i.value,i)}),G.value=!1},F=async(l,o)=>{o.key==="upload_mode"&&(l==1&&_.value.map(a=>{a.key.indexOf("local_")!==-1&&(a.display=!0),(a.key.indexOf("qiniu_")!==-1||a.key.indexOf("cos_")!==-1||a.key.indexOf("oss_")!==-1)&&(a.display=!1)}),l==2&&_.value.map(a=>{a.key.indexOf("oss_")!==-1&&(a.display=!0),(a.key.indexOf("qiniu_")!==-1||a.key.indexOf("cos_")!==-1||a.key.indexOf("local_")!==-1)&&(a.display=!1)}),l==3&&_.value.map(a=>{a.key.indexOf("qiniu_")!==-1&&(a.display=!0),(a.key.indexOf("local_")!==-1||a.key.indexOf("cos_")!==-1||a.key.indexOf("oss_")!==-1)&&(a.display=!1)}),l==4&&_.value.map(a=>{a.key.indexOf("cos_")!==-1&&(a.display=!0),(a.key.indexOf("qiniu_")!==-1||a.key.indexOf("local_")!==-1||a.key.indexOf("oss_")!==-1)&&(a.display=!1)}))},J=async l=>{if(!fe("/core/config/update")){k.info("没有权限修改配置");return}const o={group_id:f.value.id,config:l},a=await V.batchUpdate(o);a.code===200&&k.success(a.message)},K=async()=>{if(!/^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/.test(w.value)){k.info("请输入正确的邮箱地址");return}const o=await V.testEmail({email:w.value});o.code===200&&k.success(o.message)},P=()=>{const l=f.value.id;L.value.open(l)},Q=()=>{var l;return(l=h.value)==null?void 0:l.open()},W=l=>{var o,a;(o=h.value)==null||o.open("edit"),(a=h.value)==null||a.setFormData(l)};return re(()=>{M()}),(l,o)=>{const a=n("icon-plus"),m=n("a-button"),b=n("a-tooltip"),i=n("icon-edit"),R=n("a-link"),X=n("icon-delete"),Y=n("a-list-item"),Z=n("a-list"),ee=n("icon-settings"),ae=n("a-select"),q=n("a-input"),oe=n("a-radio-group"),le=n("a-textarea"),ne=n("sa-upload-image"),te=n("sa-upload-file"),se=n("ma-wangEditor"),B=n("a-form-item"),de=n("a-form"),ue=n("a-card"),ce=n("a-modal"),O=pe("auth");return d(),E("div",me,[p("div",ge,[u(Z,{"max-height":650,scrollbar:!0,size:"small"},{header:t(()=>[p("div",ke,[xe,u(b,{content:"添加组"},{default:t(()=>[x((d(),c(m,{shape:"round",size:"small",onClick:Q,type:"primary"},{icon:t(()=>[u(a)]),_:1})),[[O,["/core/config/save"]]])]),_:1})])]),default:t(()=>[(d(!0),E(S,null,j(C.value,(e,ie)=>(d(),c(Y,null,{default:t(()=>[p("div",Ve,[u(m,{type:$.value==e.name?"outline":"",onClick:s=>N(e.id,e.name,e.code)},{default:t(()=>[g(U(e.name)+"("+U(e.code)+") ",1)]),_:2},1032,["type","onClick"]),p("div",he,[x((d(),c(R,{onClick:s=>W(e)},{icon:t(()=>[u(i)]),_:2},1032,["onClick"])),[[O,["/core/config/update"]]]),x((d(),c(R,{onClick:s=>H(e)},{icon:t(()=>[u(X)]),_:2},1032,["onClick"])),[[O,["/core/config/destroy"]]])])])]),_:2},1024))),256))]),_:1})]),p("div",Ce,[u(ue,{title:$.value,loading:G.value,"header-style":{height:"45px"}},{extra:t(()=>[x((d(),c(m,{type:"primary",shape:"circle",onClick:o[0]||(o[0]=e=>P())},{default:t(()=>[u(ee)]),_:1})),[[O,["/core/config/index"]]])]),default:t(()=>[p("div",we,[u(de,{model:A.value,"auto-label-width":""},{default:t(()=>[(d(!0),E(S,null,j(_.value,(e,ie)=>x((d(),c(B,{label:e.name,field:e.key,extra:e.remark},{default:t(()=>[e.input_type==="select"?(d(),c(ae,{key:0,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,options:e.config_select_data,onChange:s=>F(s,e),placeholder:"请选择"+e.name},null,8,["modelValue","onUpdate:modelValue","options","onChange","placeholder"])):v("",!0),e.input_type==="input"?(d(),c(q,{key:1,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,placeholder:"请输入"+e.name},null,8,["modelValue","onUpdate:modelValue","placeholder"])):v("",!0),e.input_type==="radio"?(d(),c(oe,{key:2,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,options:e.config_select_data},null,8,["modelValue","onUpdate:modelValue","options"])):v("",!0),e.input_type==="textarea"?(d(),c(le,{key:3,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,placeholder:"请输入"+e.name},null,8,["modelValue","onUpdate:modelValue","placeholder"])):v("",!0),e.input_type==="uploadImage"?(d(),c(ne,{key:4,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s},null,8,["modelValue","onUpdate:modelValue"])):v("",!0),e.input_type==="uploadFile"?(d(),c(te,{key:5,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s},null,8,["modelValue","onUpdate:modelValue"])):v("",!0),e.input_type==="wangEditor"?(d(),c(se,{key:6,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s},null,8,["modelValue","onUpdate:modelValue"])):v("",!0)]),_:2},1032,["label","field","extra"])),[[_e,e.display]])),256)),_.value.length>0?(d(),c(B,{key:0},{default:t(()=>[u(m,{type:"primary",onClick:o[1]||(o[1]=e=>J(_.value))},{default:t(()=>[g("保存修改")]),_:1})]),_:1})):v("",!0),f.value.code==="email_config"?(d(),c(B,{key:1,label:"测试邮件"},{default:t(()=>[u(q,{modelValue:w.value,"onUpdate:modelValue":o[2]||(o[2]=e=>w.value=e),placeholder:"请输入正确的邮箱接收地址"},null,8,["modelValue"]),u(m,{type:"primary",class:"ml-2",onClick:o[3]||(o[3]=e=>K())},{default:t(()=>[g("发送")]),_:1})]),_:1})):v("",!0)]),_:1},8,["model"])])]),_:1},8,["title","loading"])]),u(ce,{visible:D.value,"onUpdate:visible":o[5]||(o[5]=e=>D.value=e),type:"warning","on-before-ok":I},{title:t(()=>[g("危险操作")]),default:t(()=>[p("div",be,[g(" 确定要删除 "),p("span",Oe,U(y.value.name),1),g(" 配置组吗？ ")]),p("div",null,[g(" 此操作会删除组和所属组配置项，如果执行请在下面输入框输入："),p("span",Ue,U(y.value.name),1)]),u(q,{placeholder:`请输入 ${y.value.name}`,class:"mt-2",modelValue:z.value,"onUpdate:modelValue":o[4]||(o[4]=e=>z.value=e)},null,8,["placeholder","modelValue"])]),_:1},8,["visible"]),u(ve,{ref_key:"addGroupRef",ref:h,onSuccess:M},null,512),u(ye,{ref_key:"manageConfigRef",ref:L,onClose:T},null,512)])}}};export{qe as default};
