import{a as _}from"./dataMaintain-BO0hPD53.js";import{a as R}from"./generate-Db7nyP4X.js";import{k as n,S as x,r as o,o as q,h as A,w as t,f,d as l,M as y,y as $}from"./index-oR0mlNqp.js";const H={__name:"loadTable",emits:["success"],setup(j,{expose:k,emit:S}){const p=n(),r=n([]),d=n(!1),c=n("mysql"),v=n({}),h=n({}),C=S,m=n({name:"",source:""}),i=n([]),b=()=>{m.value.source=c.value,g.api=_.getPageList,p.value.refresh()},V=async s=>{if(r.value.length<1){y.info("至少要选择一条数据"),s(!1);return}let e=[];p.value.getTableData().filter(a=>{r.value.includes(a.name)&&e.push({name:a.name,comment:a.comment,sourceName:a.name})}),e.map(a=>{h.value[a.sourceName]&&(a.comment=h.value[a.sourceName]),v.value[a.name]&&(a.name=v.value[a.name])}),(await R.loadTable({source:c.value,names:e})).code===200&&(y.success("装载成功"),C("success"),r.value=[],s(!0))},N=s=>{r.value=s},I=async()=>{d.value=!0;const s=await _.getDataSource();i.value=s.data.map(e=>({label:e,value:e})),c.value=i.value[0]?i.value[0].value:"",$(()=>{b()})},g=x({pk:"name",api:_.getPageList,height:670,showIndex:!0,showSort:!1,operationColumn:!1,rowSelection:{showCheckedAll:!0,key:"name",onlyCurrent:!0}}),T=x([{title:"表名称",dataIndex:"name",align:"left",width:200},{title:"表注释",dataIndex:"comment",align:"left",width:180},{title:"引擎",dataIndex:"engine",width:150},{title:"编码",dataIndex:"collation",width:180},{title:"创建时间",dataIndex:"create_time"}]);return k({open:I}),(s,e)=>{const w=o("a-alert"),a=o("a-input"),B=o("a-form-item"),F=o("a-col"),L=o("a-select"),U=o("a-button"),D=o("a-input-group"),M=o("sa-table"),P=o("a-modal");return q(),A(P,{fullscreen:"",visible:d.value,"onUpdate:visible":e[2]||(e[2]=u=>d.value=u),"on-before-ok":V,"align-center":!1,"unmount-on-close":""},{title:t(()=>[f("装载数据表")]),default:t(()=>[l(w,{class:"mb-3",closable:""},{default:t(()=>[f(" 1、支持thinkorm配置多数据源； 2、数据源建议配置表前缀，假设前缀为[eb_]，载入表[eb_shop_category]会自动处理为[ShopCategory]类 ")]),_:1}),l(M,{ref_key:"crudRef",ref:p,options:g,columns:T,searchForm:m.value,onSelectionChange:N},{tableSearch:t(()=>[l(F,{span:8},{default:t(()=>[l(B,{field:"name",label:"表名称"},{default:t(()=>[l(a,{modelValue:m.value.name,"onUpdate:modelValue":e[0]||(e[0]=u=>m.value.name=u),placeholder:"请输入数据表名称","allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1})]),tableBeforeButtons:t(()=>[l(D,null,{default:t(()=>[l(L,{placeholder:"切换数据源",modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=u=>c.value=u),options:i.value,style:{width:"300px"}},null,8,["modelValue","options"]),l(U,{type:"primary",onClick:b},{default:t(()=>[f("确定切换")]),_:1})]),_:1})]),_:1},8,["options","columns","searchForm"])]),_:1},8,["visible"])}}};export{H as default};
