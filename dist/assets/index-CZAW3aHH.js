import{fn as g,_ as de,fw as ue,k as f,fs as _e,A as me,S as M,M as v,r as a,o as d,c as S,l as u,d as t,J as pe,e as y,w as e,f as w,h,i as N,F as fe,g as he,q as x,t as k,p as ge}from"./index-oR0mlNqp.js";const b={getPageList(i={}){return g({url:"/core/attachment/index",method:"get",params:i})},getRecyclePageList(i={}){return g({url:"/core/attachment/recycle",method:"get",params:i})},deletes(i){return g({url:"/core/attachment/destroy",method:"delete",data:i})},recoverys(i){return g({url:"/core/attachment/recovery",method:"post",data:i})},realDestroy(i){return g({url:"/core/attachment/realDestroy",method:"delete",data:i})}},ve={class:"ma-content-block lg:flex justify-between"},ye={class:"w-full p-4 pr-4 border-r border-gray-100 lg:w-2/12"},we={class:"lg:w-10/12 w-full"},ke={class:"actions"},be=["onClick"],xe={class:"action"},Ve={name:"system:attachment"},Ce=Object.assign(Ve,{setup(i){const A=ue().data,c=f(),m=f("list"),V=f(["all"]),B=f([]),p=f([]);let P=_e(()=>c.value?c.value.isRecovery:!1);me(async()=>{var n;const o=A.attachment_type;B.value=[{label:"所有",value:"all"},...o],(n=c.value)==null||n.refresh()});const $=async o=>{V.value=o;const n=o[0]==="all"?void 0:o[0];_.value.mime_type=n,c.value.refresh()},q=()=>{m.value=m.value==="list"?"window":"list"},U=async o=>{const n=await ge.downloadById(o.id);n?(x.download(n,o.origin_name),v.success("请求成功，文件开始下载")):v.error("文件下载失败")},z=o=>{p.value=o,c.value.setSelecteds(o)},E=()=>{c.value.getTableData().map(o=>p.value.push(o.id)),c.value.setSelecteds(p.value)},T=()=>{p.value=[],c.value.setSelecteds([])},_=f({origin_name:"",mime_type:"",storage_mode:"",create_time:[]}),J=M({api:b.getPageList,recycleApi:b.getRecyclePageList,pageLayout:"fixed",rowSelection:{showCheckedAll:!0},singleLine:!0,delete:{show:!0,auth:["/core/attachment/destroy"],func:async o=>{var r;(await b.deletes(o)).code===200&&(v.success("删除成功！"),(r=c.value)==null||r.refresh())},realAuth:["/core/attachment/realDestroy"],realFunc:async o=>{var r;(await b.realDestroy(o)).code===200&&(v.success("销毁成功！"),(r=c.value)==null||r.refresh())}},recovery:{show:!0,auth:["/core/attachment/recovery"],func:async o=>{var r;(await b.recoverys(o)).code===200&&(v.success("恢复成功！"),(r=c.value)==null||r.refresh())}}}),K=M([{title:"预览",dataIndex:"url",width:80},{title:"存储名称",dataIndex:"object_name",width:220},{title:"原文件名",dataIndex:"origin_name",width:150},{title:"存储模式",dataIndex:"storage_mode",dict:"upload_mode",width:100},{title:"资源类型",dataIndex:"mime_type",width:130},{title:"存储目录",dataIndex:"storage_path",width:130},{title:"文件大小",dataIndex:"size_info",width:130},{title:"上传时间",dataIndex:"create_time",width:180}]);return(o,n)=>{const r=a("sa-tree-slider"),O=a("a-input"),C=a("a-form-item"),I=a("a-col"),G=a("sa-select"),H=a("a-range-picker"),Q=a("icon-select-all"),D=a("a-button"),W=a("icon-eraser"),X=a("a-input-group"),Y=a("icon-apps"),Z=a("icon-list"),L=a("a-tooltip"),ee=a("icon-check"),te=a("a-tag"),ae=a("a-checkbox"),F=a("icon-download"),oe=a("icon-info-circle"),R=a("a-image"),ne=a("a-space"),le=a("a-image-preview-group"),se=a("a-checkbox-group"),ce=a("a-avatar"),ie=a("a-link"),re=a("sa-table");return d(),S("div",ve,[u("div",ye,[t(r,{data:B.value,border:!1,"search-placeholder":"搜索资源类型","field-names":{title:"label",key:"value"},onClick:$,icon:"icon-folder",modelValue:V.value,"onUpdate:modelValue":n[0]||(n[0]=l=>V.value=l)},null,8,["data","modelValue"])]),u("div",we,[t(re,{ref_key:"crudRef",ref:c,options:J,columns:K,searchForm:_.value},pe({tableSearch:e(()=>[t(I,{span:7},{default:e(()=>[t(C,{field:"origin_name",label:"原文件名"},{default:e(()=>[t(O,{modelValue:_.value.origin_name,"onUpdate:modelValue":n[1]||(n[1]=l=>_.value.origin_name=l),placeholder:"请输入原文件名"},null,8,["modelValue"])]),_:1})]),_:1}),t(I,{span:7},{default:e(()=>[t(C,{field:"storage_mode",label:"存储模式"},{default:e(()=>[t(G,{modelValue:_.value.storage_mode,"onUpdate:modelValue":n[2]||(n[2]=l=>_.value.storage_mode=l),dict:"upload_mode",placeholder:"请选择存储模式"},null,8,["modelValue"])]),_:1})]),_:1}),t(I,{span:10},{default:e(()=>[t(C,{field:"create_time",label:"上传时间"},{default:e(()=>[t(H,{modelValue:_.value.create_time,"onUpdate:modelValue":n[3]||(n[3]=l=>_.value.create_time=l)},null,8,["modelValue"])]),_:1})]),_:1})]),tableAfterButtons:e(()=>[m.value==="window"?(d(),h(X,{key:0},{default:e(()=>[t(D,{onClick:E},{icon:e(()=>[t(Q)]),default:e(()=>[w("全选 ")]),_:1}),t(D,{onClick:T},{icon:e(()=>[t(W)]),default:e(()=>[w("清除 ")]),_:1})]),_:1})):N("",!0)]),tools:e(()=>[t(L,{content:m.value==="list"?"切换橱窗模式":"切换列表模式"},{default:e(()=>[t(D,{shape:"circle",onClick:q},{default:e(()=>[m.value==="list"?(d(),h(Y,{key:0})):(d(),h(Z,{key:1}))]),_:1})]),_:1},8,["content"])]),crudContent:e(l=>[m.value==="window"?(d(),h(se,{key:0,modelValue:p.value,"onUpdate:modelValue":n[4]||(n[4]=s=>p.value=s),onChange:z},{default:e(()=>[t(le,{infinite:""},{default:e(()=>[t(ne,{class:"window-list"},{default:e(()=>[(d(!0),S(fe,null,he(l.data,s=>(d(),S("div",{key:s.id,class:"mb-2 image-content"},[t(ae,{value:s.id,class:"checkbox"},{checkbox:e(({checked:j})=>[t(te,{checked:j,color:"blue",checkable:""},{default:e(()=>[t(ee),w(" 选择")]),_:2},1032,["checked"])]),_:2},1032,["value"]),t(R,{width:"190",height:"190","show-loader":"",title:s.origin_name,description:`大小：${s.size_info}`,src:/image/g.test(s.mime_type)?y(x).attachUrl(s.url):o.$url+"not-image.png"},{extra:e(()=>[u("div",ke,[t(L,{content:"下载此文件"},{default:e(()=>[u("span",{class:"action",onClick:j=>U(s)},[t(F)],8,be)]),_:2},1024),t(L,null,{content:e(()=>[u("div",null,"存储名称："+k(s.object_name),1),u("div",null,"存储目录："+k(s.storage_path),1),u("div",null,"上传时间："+k(s.create_time),1),u("div",null,"存储模式："+k(y(x).getLabel(s.storage_mode,y(A).upload_mode)),1)]),default:e(()=>[u("span",xe,[t(oe)])]),_:2},1024)])]),_:2},1032,["title","description","src"])]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])):N("",!0)]),url:e(({record:l})=>[/image/g.test(l.mime_type)?(d(),h(R,{key:0,class:"list-image",width:"40px",height:"40px",src:y(x).attachUrl(l.url)},null,8,["src"])):(d(),h(ce,{key:1,shape:"square",style:{top:"0px"}},{default:e(()=>[w(k(l.suffix),1)]),_:2},1024))]),_:2},[y(P)?void 0:{name:"operationBeforeExtend",fn:e(({record:l})=>[t(ie,{onClick:s=>U(l)},{default:e(()=>[t(F),w(" 下载")]),_:2},1032,["onClick"])]),key:"0"}]),1032,["options","columns","searchForm"])])])}}}),De=de(Ce,[["__scopeId","data-v-d15f43e7"]]);export{De as default};
