import{k as r,fs as R,S as A,r as d,o as G,h as K,w as n,d as t,e as N,K as O,p as P,M as S}from"./index-oR0mlNqp.js";import{a as v}from"./role-BUKAsSP8.js";const E={__name:"edit",emits:["success"],setup(T,{expose:V,emit:b}){const k=b,f=r(),c=r(""),i=r(!1),p=r(!1),_=r([]);let w=R(()=>"角色管理"+(c.value=="add"?"-新增":"-编辑"));const a=A({id:"",parent_id:"",level:"",name:"",code:"",sort:100,status:1,remark:""}),g={parent_id:[{required:!0,message:"上级角色不能为空"}],name:[{required:!0,message:"角色名称不能为空"}],code:[{required:!0,message:"角色标识不能为空"}]},y=async(o="add")=>{c.value=o,i.value=!0,f.value.resetFields(),await x()},x=async()=>{const o=await await P.commonGet("/core/role/index?tree=true&filter=false");_.value=o.data},U=async o=>{for(const e in a)o[e]!=null&&o[e]!=null&&(a[e]=o[e])},C=async o=>{var m;if(!await((m=f.value)==null?void 0:m.validate())){p.value=!0;let s={...a},u={};c.value==="add"?(s.id=void 0,u=await v.save(s)):u=await v.update(s.id,s),u.code===200&&(S.success("操作成功"),k("success"),o(!0)),setTimeout(()=>{p.value=!1},500)}o(!1)},D=()=>i.value=!1;return V({open:y,setFormData:U}),(o,e)=>{const m=d("a-tree-select"),s=d("a-form-item"),u=d("a-input"),q=d("a-input-number"),B=d("sa-radio"),F=d("a-textarea"),M=d("a-form");return G(),K(O("a-modal"),{visible:i.value,"onUpdate:visible":e[6]||(e[6]=l=>i.value=l),width:600,title:N(w),"mask-closable":!1,"ok-loading":p.value,onCancel:D,onBeforeOk:C},{default:n(()=>[t(M,{ref_key:"formRef",ref:f,model:a,rules:g,"auto-label-width":!0},{default:n(()=>[t(s,{field:"parent_id",label:"上级角色"},{default:n(()=>[t(m,{modelValue:a.parent_id,"onUpdate:modelValue":e[0]||(e[0]=l=>a.parent_id=l),data:_.value,"field-names":{key:"value",title:"label"},"allow-clear":"",placeholder:"请选择上级角色"},null,8,["modelValue","data"])]),_:1}),t(s,{label:"角色名称",field:"name"},{default:n(()=>[t(u,{modelValue:a.name,"onUpdate:modelValue":e[1]||(e[1]=l=>a.name=l),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(s,{label:"角色标识",field:"code"},{default:n(()=>[t(u,{modelValue:a.code,"onUpdate:modelValue":e[2]||(e[2]=l=>a.code=l),placeholder:"请输入角色标识"},null,8,["modelValue"])]),_:1}),t(s,{label:"排序数字",field:"sort"},{default:n(()=>[t(q,{modelValue:a.sort,"onUpdate:modelValue":e[3]||(e[3]=l=>a.sort=l),placeholder:"请输入排序数字"},null,8,["modelValue"])]),_:1}),t(s,{label:"状态",field:"status"},{default:n(()=>[t(B,{modelValue:a.status,"onUpdate:modelValue":e[4]||(e[4]=l=>a.status=l),dict:"data_status",placeholder:"请选择状态"},null,8,["modelValue"])]),_:1}),t(s,{label:"备注",field:"remark"},{default:n(()=>[t(F,{modelValue:a.remark,"onUpdate:modelValue":e[5]||(e[5]=l=>a.remark=l),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},40,["visible","title","ok-loading"])}}};export{E as default};
