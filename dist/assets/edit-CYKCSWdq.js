import{k as r,m as A,S as v,fs as G,r as u,o as I,h as K,w as n,d as t,e as N,K as O,M as P,p as T}from"./index-oR0mlNqp.js";import{a as V}from"./dept-Dz9w8F50.js";const H={__name:"edit",emits:["success"],setup(j,{expose:b,emit:k}){const w=k,p=r(),f=r(""),i=r(!1),c=r(!1),U=A(),y=v({...U.user}),_=r([]);let g=G(()=>"部门管理"+(f.value=="add"?"-新增":"-编辑"));const a=v({id:"",parent_id:"",level:"",name:"",leader:"",phone:"",status:1,sort:100,remark:""}),x={parent_id:[{required:!0,message:"上级部门不能为空"}],name:[{required:!0,message:"部门名称不能为空"}]},C=async()=>{const o=await await T.commonGet("/core/dept/index?tree=true&filter=false");y.id===1?_.value=[{label:"无上级部门",value:0,children:o.data}]:_.value=o.data},D=async(o="add")=>{f.value=o,i.value=!0,p.value.resetFields(),await C()},B=async o=>{for(const e in a)o[e]!=null&&o[e]!=null&&(a[e]=o[e])},S=async o=>{var m;if(!await((m=p.value)==null?void 0:m.validate())){c.value=!0;let s={...a},d={};f.value==="add"?(s.id=void 0,d=await V.save(s)):d=await V.update(s.id,s),d.code===200&&(P.success("操作成功"),w("success"),o(!0)),setTimeout(()=>{c.value=!1},500)}o(!1)},q=()=>i.value=!1;return b({open:D,setFormData:B}),(o,e)=>{const m=u("a-tree-select"),s=u("a-form-item"),d=u("a-input"),F=u("a-input-number"),M=u("sa-radio"),R=u("a-textarea"),h=u("a-form");return I(),K(O("a-modal"),{visible:i.value,"onUpdate:visible":e[7]||(e[7]=l=>i.value=l),width:600,title:N(g),"mask-closable":!1,"ok-loading":c.value,onCancel:q,onBeforeOk:S},{default:n(()=>[t(h,{ref_key:"formRef",ref:p,model:a,rules:x,"auto-label-width":!0},{default:n(()=>[t(s,{field:"parent_id",label:"上级部门"},{default:n(()=>[t(m,{modelValue:a.parent_id,"onUpdate:modelValue":e[0]||(e[0]=l=>a.parent_id=l),data:_.value,"field-names":{key:"value",title:"label"},"allow-clear":"",placeholder:"请选择上级部门"},null,8,["modelValue","data"])]),_:1}),t(s,{label:"部门名称",field:"name"},{default:n(()=>[t(d,{modelValue:a.name,"onUpdate:modelValue":e[1]||(e[1]=l=>a.name=l),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),t(s,{label:"负责人",field:"leader"},{default:n(()=>[t(d,{modelValue:a.leader,"onUpdate:modelValue":e[2]||(e[2]=l=>a.leader=l),placeholder:"请输入负责人"},null,8,["modelValue"])]),_:1}),t(s,{label:"手机",field:"phone"},{default:n(()=>[t(d,{modelValue:a.phone,"onUpdate:modelValue":e[3]||(e[3]=l=>a.phone=l),placeholder:"请输入手机"},null,8,["modelValue"])]),_:1}),t(s,{label:"排序数字",field:"sort"},{default:n(()=>[t(F,{modelValue:a.sort,"onUpdate:modelValue":e[4]||(e[4]=l=>a.sort=l),placeholder:"请输入排序数字"},null,8,["modelValue"])]),_:1}),t(s,{label:"状态",field:"status"},{default:n(()=>[t(M,{modelValue:a.status,"onUpdate:modelValue":e[5]||(e[5]=l=>a.status=l),dict:"data_status",placeholder:"请选择状态"},null,8,["modelValue"])]),_:1}),t(s,{label:"备注",field:"remark"},{default:n(()=>[t(R,{modelValue:a.remark,"onUpdate:modelValue":e[6]||(e[6]=l=>a.remark=l),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},40,["visible","title","ok-loading"])}}};export{H as default};
