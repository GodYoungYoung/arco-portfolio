import{a as c}from"./user-4eeYX97f.js";import{k as d,fs as oe,S as B,M as m,A as le,r as n,fu as ne,o as p,c as P,l as x,d as o,w as s,f as _,i as H,e as ue,h,L as U,F as re,g as ce,t as de,ft as ie,p as L}from"./index-oR0mlNqp.js";import pe from"./edit-D-5aSTAY.js";const me={class:"ma-content-block lg:flex justify-between"},_e={class:"lg:w-2/12 pt-4 pl-2 pr-2"},fe={class:"lg:w-10/12 w-full"},ve=["src"],he={key:0},be={__name:"index",setup(we){const R=d([{label:"所有部门",value:0}]),S=d([]),r=d(),g=d(),u=d({username:"",phone:"",email:"",status:"",create_time:[],dept_id:""}),y=d(!1),D=d(),V=d(""),w=d([0]);let M=oe(()=>r.value?r.value.isRecovery:!1);const N=async()=>{w.value=[0],u.value.dept_id=""},$=a=>{u.value.dept_id=a[0]===0?"":a[0],r.value.refresh(),w.value=a},j=async(a,e)=>{const l=await c.changeStatus({id:e,status:a});l.code===200&&(m.success(l.message),r.value.refresh())},I=a=>{c.clearCache({id:a}).then(e=>e.code===200&&m.success(e.message))},O=async a=>{c.initUserPassword({id:a}).then(e=>e.code===200&&m.success(e.message))},E=async a=>{const e=await c.setHomePage({id:D.value,dashboard:V.value});e.code===200&&(m.success(e.message),r.value.refresh(),a(!0)),a(!1)},G=(a,e)=>{if(a==="resetPassword"){ie.info({title:"提示",content:"确定将该用户密码重置为 sai123456 吗？",simple:!1,onBeforeOk:l=>{O(e),l(!0)}});return}if(a==="updateCache"){I(e);return}if(a==="setHomePage"){y.value=!0,D.value=e;return}},K=B({api:c.getPageList,recycleApi:c.getRecyclePageList,rowSelection:{showCheckedAll:!0},operationColumnWidth:210,add:{show:!0,auth:["/core/user/save"],func:async()=>{var a;(a=g.value)==null||a.open()}},edit:{show:!0,auth:["/core/user/update"],func:async a=>{var e;(e=g.value)==null||e.open("edit",a.id)}},delete:{show:!0,auth:["/core/user/destroy"],func:async a=>{var l;(await c.delete(a)).code===200&&(m.success("删除成功！"),(l=r.value)==null||l.refresh())},realAuth:["/core/user/realDestroy"],realFunc:async a=>{var l;(await c.realDestroy(a)).code===200&&(m.success("销毁成功！"),(l=r.value)==null||l.refresh())}},recovery:{show:!0,auth:["/core/user/recovery"],func:async a=>{var l;(await c.recovery(a)).code===200&&(m.success("恢复成功！"),(l=r.value)==null||l.refresh())}}}),T=B([{title:"头像",dataIndex:"avatar",width:75},{title:"账户",dataIndex:"username",width:130},{title:"昵称",dataIndex:"nickname",width:120},{title:"手机",dataIndex:"phone",width:150},{title:"邮箱",dataIndex:"email",width:200},{title:"状态",dataIndex:"status",width:100,dict:"data_status"},{title:"工作台",dataIndex:"dashboard",width:100},{title:"注册时间",dataIndex:"create_time",width:180}]),W=async()=>{(await L.commonGet("/core/dept/accessDept")).data.map(l=>{R.value.push(l)});const e=await L.getDict("dashboard");S.value=e.data},F=async()=>{var a;(a=r.value)==null||a.refresh()};return le(()=>{W(),F()}),(a,e)=>{const l=n("sa-tree-slider"),b=n("a-input"),f=n("a-form-item"),v=n("a-col"),q=n("a-range-picker"),z=n("sa-select"),J=n("sa-switch"),Q=n("a-avatar"),X=n("icon-refresh"),A=n("a-link"),Y=n("icon-double-right"),k=n("a-doption"),Z=n("a-dropdown"),ee=n("sa-table"),ae=n("a-option"),te=n("a-select"),se=n("a-modal"),C=ne("auth");return p(),P("div",me,[x("div",_e,[o(l,{data:R.value,"search-placeholder":"搜索部门",onClick:$,modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t)},null,8,["data","modelValue"])]),x("div",fe,[o(ee,{ref_key:"crudRef",ref:r,options:K,columns:T,searchForm:u.value,onResetSearch:N},{tableSearch:s(()=>[o(v,{span:8},{default:s(()=>[o(f,{field:"username",label:"账号名称"},{default:s(()=>[o(b,{modelValue:u.value.username,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.username=t),placeholder:"请输入账号名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:8},{default:s(()=>[o(f,{field:"phone",label:"手机"},{default:s(()=>[o(b,{modelValue:u.value.phone,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.phone=t),placeholder:"请输入手机"},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:8},{default:s(()=>[o(f,{field:"email",label:"邮箱"},{default:s(()=>[o(b,{modelValue:u.value.email,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:16},{default:s(()=>[o(f,{field:"create_time",label:"注册时间"},{default:s(()=>[o(q,{modelValue:u.value.create_time,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.create_time=t),"show-time":"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{span:8},{default:s(()=>[o(f,{field:"status",label:"状态"},{default:s(()=>[o(z,{modelValue:u.value.status,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.status=t),dict:"data_status",placeholder:"请选择状态","alow-clear":""},null,8,["modelValue"])]),_:1})]),_:1})]),status:s(({record:t})=>[o(J,{modelValue:t.status,"onUpdate:modelValue":i=>t.status=i,onChange:i=>j(i,t.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),avatar:s(({record:t})=>[o(Q,null,{default:s(()=>[x("img",{src:t.avatar?a.$tool.showFile(t.avatar):a.$url+"avatar.jpg",style:{"object-fit":"cover"}},null,8,ve)]),_:2},1024)]),operationCell:s(({record:t})=>[t.id==1?(p(),P("div",he,[o(A,{onClick:i=>I(t.id)},{default:s(()=>[o(X),_(" 更新缓存")]),_:2},1032,["onClick"])])):H("",!0)]),operationAfterExtend:s(({record:t})=>[t.id!=1&&!ue(M)?(p(),h(Z,{key:0,trigger:"hover",onSelect:i=>G(i,t.id)},{content:s(()=>[U((p(),h(k,{value:"updateCache"},{default:s(()=>[_("更新缓存")]),_:1})),[[C,["/core/user/cache"]]]),U((p(),h(k,{value:"setHomePage"},{default:s(()=>[_("设置首页")]),_:1})),[[C,["/core/user/setHomePage"]]]),U((p(),h(k,{value:"resetPassword"},{default:s(()=>[_("重置密码")]),_:1})),[[C,["/core/user/initUserPassword"]]])]),default:s(()=>[o(A,null,{default:s(()=>[o(Y),_(" 更多")]),_:1})]),_:2},1032,["onSelect"])):H("",!0)]),_:1},8,["options","columns","searchForm"])]),o(pe,{ref_key:"editRef",ref:g,onSuccess:F},null,512),o(se,{visible:y.value,"onUpdate:visible":e[7]||(e[7]=t=>y.value=t),onBeforeOk:E},{title:s(()=>[_("设置用户后台首页")]),default:s(()=>[o(f,{label:"用户首页"},{default:s(()=>[o(te,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=t=>V.value=t),placeholder:"请选择用户首页"},{default:s(()=>[(p(!0),P(re,null,ce(S.value,(t,i)=>(p(),h(ae,{key:i,value:t.value},{default:s(()=>[_(de(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["visible"])])}}};export{be as default};
