import{a as x}from"./role-BUKAsSP8.js";import{m as K}from"./menu-DzJnGZEV.js";import{_ as z,k as u,r as d,o as D,h as I,w as l,f,d as s,l as y,M as O}from"./index-oR0mlNqp.js";const S={class:"w-full"},j={class:"tree-container"},q={__name:"menuPermission",emits:["success"],setup(F,{expose:V,emit:C}){const r=u(!1),v=u(!0),h=u([]),p=u([]),_=u(!1),i=u(),c=u({name:void 0,code:void 0}),N=C,w=async e=>{r.value=!0,c.value={id:e.id,name:e.name,code:e.code},g(!1),b(!1),k(!1),await M(e.id)},g=e=>{i.value.saTree.expandAll(e)},b=e=>{i.value.saTree.checkAll(e)},k=e=>{_.value=e},B=e=>{const a=i.value.saTree,n=a.getExpandedNodes().map(t=>t.id);a.expandNode(e,!n.includes(e[0]))},M=async e=>{v.value=!0;const a=await K.getList({tree:!0,auth:!0});h.value=a.data;const n=await x.getMenuByRole(e);p.value=n.data.menus.map(t=>t.id),p.value.length>0&&k(!0),v.value=!1},T=async e=>{const n=i.value.saTree.getCheckedNodes().map(m=>m.id),t=await x.updateMenuPermission(c.value.id,{menu_ids:n});t.code===200&&O.success(t.message),N("success"),e(!0)},U=()=>r.value=!1;return V({open:w}),(e,a)=>{const n=d("a-input"),t=d("a-form-item"),m=d("a-checkbox"),L=d("a-space"),P=d("sa-tree-slider"),R=d("a-spin"),A=d("a-form"),E=d("a-modal");return D(),I(E,{visible:r.value,"onUpdate:visible":a[4]||(a[4]=o=>r.value=o),onCancel:U,onBeforeOk:T},{title:l(()=>[f("菜单权限")]),default:l(()=>[s(A,{model:c.value},{default:l(()=>[s(t,{label:"角色名称",field:"name"},{default:l(()=>[s(n,{disabled:"",modelValue:c.value.name,"onUpdate:modelValue":a[0]||(a[0]=o=>c.value.name=o)},null,8,["modelValue"])]),_:1}),s(t,{label:"角色标识",field:"code"},{default:l(()=>[s(n,{disabled:"",modelValue:c.value.code,"onUpdate:modelValue":a[1]||(a[1]=o=>c.value.code=o)},null,8,["modelValue"])]),_:1}),s(t,{label:"菜单列表",field:"menu_ids"},{default:l(()=>[s(R,{loading:v.value,tip:"菜单加载中...",class:"w-full"},{default:l(()=>[y("div",S,[s(L,{class:"mt-1.5",size:"large"},{default:l(()=>[s(m,{onChange:g},{default:l(()=>[f("展开/折叠")]),_:1}),s(m,{onChange:b},{default:l(()=>[f("全选/全不选")]),_:1}),s(m,{modelValue:_.value,"onUpdate:modelValue":a[2]||(a[2]=o=>_.value=o),onChange:k},{default:l(()=>[f("关闭父子级联动")]),_:1},8,["modelValue"])]),_:1}),y("div",j,[s(P,{ref_key:"tree",ref:i,data:h.value,checkable:"",fieldNames:{title:"label",key:"id"},searchPlaceholder:"过滤菜单","checked-keys":p.value,"onUpdate:checkedKeys":a[3]||(a[3]=o=>p.value=o),"check-strictly":_.value,"virtual-list-props":{height:300},onClick:B},null,8,["data","checked-keys","check-strictly"])])])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}},Q=z(q,[["__scopeId","data-v-b2f674eb"]]);export{Q as default};
