import{a as d}from"./crontab-D56oAgVs.js";import O from"./logList-B3oaEZIH.js";import P from"./edit-BV6cnnbe.js";import{k as p,S as g,M as f,A as T,r as s,fu as A,o as b,c as N,d as e,w as n,L as j,h as G,f as k}from"./index-oR0mlNqp.js";const W={class:"ma-content-block lg:flex justify-between"},Q={__name:"index",setup(q){const u=p(),r=p(),h=p(),c=p({name:"",type:"",status:""}),v=[{label:"URL任务GET",value:1},{label:"URL任务POST",value:2},{label:"类任务",value:3}],V=async(t,a)=>{const l=await d.changeStatus({id:a,status:t});l.code===200&&(f.success(l.message),u.value.refresh())},x=async t=>{const a=await d.run({id:t.id});a.code===200&&(f.success(a.message),u.value.refresh())},C=t=>{h.value.open(t.id)},R=g({api:d.getPageList,rowSelection:{showCheckedAll:!0},operationColumnWidth:280,add:{show:!0,auth:["/core/crontab/save"],func:async()=>{var t;(t=r.value)==null||t.open()}},edit:{show:!0,auth:["/core/crontab/update"],func:async t=>{var a,l;(a=r.value)==null||a.open("edit"),(l=r.value)==null||l.setFormData(t)}},delete:{show:!0,auth:["/core/crontab/destroy"],func:async t=>{var l;(await d.delete(t)).code===200&&(f.success("删除成功！"),(l=u.value)==null||l.refresh())}}}),S=g([{title:"任务名称",dataIndex:"name",width:200},{title:"任务类型",dataIndex:"type",options:v,width:150},{title:"定时规则",dataIndex:"rule",width:150},{title:"调用目标",dataIndex:"target",width:260},{title:"状态",dataIndex:"status",dict:"data_status",width:120},{title:"创建时间",dataIndex:"create_time",width:180}]),U=async()=>{},w=async()=>{var t;(t=u.value)==null||t.refresh()};return T(async()=>{U(),w()}),(t,a)=>{const l=s("a-input"),m=s("a-form-item"),_=s("a-col"),I=s("a-select"),L=s("sa-select"),B=s("sa-switch"),F=s("icon-caret-right"),y=s("a-link"),M=s("a-popconfirm"),$=s("icon-history"),D=s("sa-table"),E=A("auth");return b(),N("div",W,[e(D,{ref_key:"crudRef",ref:u,options:R,columns:S,searchForm:c.value},{tableSearch:n(()=>[e(_,{span:8},{default:n(()=>[e(m,{field:"name",label:"任务名称"},{default:n(()=>[e(l,{modelValue:c.value.name,"onUpdate:modelValue":a[0]||(a[0]=o=>c.value.name=o),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:8},{default:n(()=>[e(m,{field:"type",label:"任务类型"},{default:n(()=>[e(I,{modelValue:c.value.type,"onUpdate:modelValue":a[1]||(a[1]=o=>c.value.type=o),options:v,"allow-clear":"",placeholder:"请选择任务类型"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:8},{default:n(()=>[e(m,{field:"status",label:"状态"},{default:n(()=>[e(L,{modelValue:c.value.status,"onUpdate:modelValue":a[2]||(a[2]=o=>c.value.status=o),dict:"data_status","allow-clear":"",placeholder:"请选择状态"},null,8,["modelValue"])]),_:1})]),_:1})]),status:n(({record:o})=>[e(B,{modelValue:o.status,"onUpdate:modelValue":i=>o.status=i,onChange:i=>V(i,o.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),operationBeforeExtend:n(({record:o})=>[e(M,{content:"确定立刻执行一次?",position:"bottom",onOk:i=>x(o)},{default:n(()=>[j((b(),G(y,null,{default:n(()=>[e(F),k(" 执行一次")]),_:1})),[[E,["/core/crontab/run"]]])]),_:2},1032,["onOk"]),e(y,{onClick:i=>C(o)},{default:n(()=>[e($),k(" 日志 ")]),_:2},1032,["onClick"])]),_:1},8,["options","columns","searchForm"]),e(P,{ref_key:"editRef",ref:r,onSuccess:w},null,512),e(O,{ref_key:"logsRef",ref:h},null,512)])}}};export{Q as default};
