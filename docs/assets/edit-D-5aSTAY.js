import{a as V}from"./user-4eeYX97f.js";import{k as m,fs as O,S,r,o as T,h as j,w as l,d as e,e as z,K as E,p as b,M as H}from"./index-oR0mlNqp.js";const W={__name:"edit",emits:["success"],setup(I,{expose:D,emit:x}){const R=x,c=m(),p=m(""),f=m(!1),v=m(!1),w=m([]),k=m([]),g=m([]);let C=O(()=>"用户管理"+(p.value=="add"?"-新增":"-编辑"));const t=S({id:"",avatar:"",username:"",dept_id:"",password:"",role_ids:[],phone:"",post_ids:[],email:"",status:1,remark:""}),q={username:[{required:!0,message:"账户不能为空"}],dept_id:[{required:!0,message:"部门不能为空"}],role_ids:[{required:!0,message:"角色不能为空"}]},B=async(n="add",a="")=>{if(p.value=n,f.value=!0,c.value.resetFields(),await G(),n=="edit"){const{data:u}=await V.read(a),d=u.postList.map(i=>i.id),s=u.roleList.map(i=>i.id);u.role_ids=s,u.post_ids=d,u.password="",U(u)}},G=async()=>{const n=await b.commonGet("/core/dept/accessDept");w.value=n.data;const a=await b.commonGet("/core/role/accessRole");k.value=a.data;const u=await b.commonGet("/core/post/accessPost");g.value=u.data},U=async n=>{for(const a in t)n[a]!=null&&n[a]!=null&&(t[a]=n[a])},F=async n=>{var u;if(!await((u=c.value)==null?void 0:u.validate())){v.value=!0;let d={...t},s={};p.value==="add"?(d.id=void 0,s=await V.save(d)):s=await V.update(d.id,d),s.code===200&&(H.success("操作成功"),R("success"),n(!0)),setTimeout(()=>{v.value=!1},500)}n(!1)},L=()=>f.value=!1;return D({open:B,setFormData:U}),(n,a)=>{const u=r("sa-upload-image"),d=r("a-form-item"),s=r("a-col"),i=r("a-row"),_=r("a-input"),y=r("a-tree-select"),M=r("a-input-password"),P=r("a-select"),A=r("sa-radio"),K=r("a-textarea"),N=r("a-form");return T(),j(E("a-modal"),{visible:f.value,"onUpdate:visible":a[11]||(a[11]=o=>f.value=o),width:800,title:z(C),"mask-closable":!1,"ok-loading":v.value,onCancel:L,onBeforeOk:F},{default:l(()=>[e(N,{ref_key:"formRef",ref:c,model:t,rules:q,"auto-label-width":!0},{default:l(()=>[e(i,{gutter:16},{default:l(()=>[e(s,{span:24},{default:l(()=>[e(d,{label:"头像",field:"avatar"},{default:l(()=>[e(u,{modelValue:t.avatar,"onUpdate:modelValue":a[0]||(a[0]=o=>t.avatar=o),rounded:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{gutter:16},{default:l(()=>[e(s,{span:12},{default:l(()=>[e(d,{field:"username",label:"账户"},{default:l(()=>[e(_,{modelValue:t.username,"onUpdate:modelValue":a[1]||(a[1]=o=>t.username=o),disabled:p.value==="edit",placeholder:"请输入账户"},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{field:"dept_id",label:"所属部门"},{default:l(()=>[e(y,{modelValue:t.dept_id,"onUpdate:modelValue":a[2]||(a[2]=o=>t.dept_id=o),data:w.value,"field-names":{key:"value",title:"label"},"allow-clear":"",placeholder:"请选择所属部门"},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1}),e(i,{gutter:16},{default:l(()=>[e(s,{span:12},{default:l(()=>[e(d,{field:"password",label:"密码"},{default:l(()=>[e(M,{modelValue:t.password,"onUpdate:modelValue":a[3]||(a[3]=o=>t.password=o),disabled:p.value==="edit",placeholder:"请输入密码"},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{field:"nickname",label:"昵称"},{default:l(()=>[e(_,{modelValue:t.nickname,"onUpdate:modelValue":a[4]||(a[4]=o=>t.nickname=o),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{gutter:16},{default:l(()=>[e(s,{span:12},{default:l(()=>[e(d,{field:"role_ids",label:"角色"},{default:l(()=>[e(y,{modelValue:t.role_ids,"onUpdate:modelValue":a[5]||(a[5]=o=>t.role_ids=o),data:k.value,"field-names":{key:"value",title:"label"},"tree-check-strictly":!0,"allow-clear":"","tree-checkable":"",placeholder:"请选择角色"},null,8,["modelValue","data"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{field:"phone",label:"手机"},{default:l(()=>[e(_,{modelValue:t.phone,"onUpdate:modelValue":a[6]||(a[6]=o=>t.phone=o),placeholder:"请输入手机"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{gutter:16},{default:l(()=>[e(s,{span:12},{default:l(()=>[e(d,{field:"post_ids",label:"岗位"},{default:l(()=>[e(P,{modelValue:t.post_ids,"onUpdate:modelValue":a[7]||(a[7]=o=>t.post_ids=o),options:g.value,"field-names":{label:"name",value:"id"},multiple:"","allow-clear":"",placeholder:"请选择岗位"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{field:"email",label:"邮箱"},{default:l(()=>[e(_,{modelValue:t.email,"onUpdate:modelValue":a[8]||(a[8]=o=>t.email=o),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{gutter:16},{default:l(()=>[e(s,{span:24},{default:l(()=>[e(d,{label:"状态",field:"status"},{default:l(()=>[e(A,{modelValue:t.status,"onUpdate:modelValue":a[9]||(a[9]=o=>t.status=o),dict:"data_status",placeholder:"请选择状态"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{gutter:16},{default:l(()=>[e(s,{span:24},{default:l(()=>[e(d,{label:"备注",field:"remark"},{default:l(()=>[e(K,{modelValue:t.remark,"onUpdate:modelValue":a[10]||(a[10]=o=>t.remark=o),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},40,["visible","title","ok-loading"])}}};export{W as default};
