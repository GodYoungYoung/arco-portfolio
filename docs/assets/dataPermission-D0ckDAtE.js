import{_ as G,k as u,r as d,o as g,h as x,w as t,f as p,d as s,c as I,F as O,g as j,t as q,L as H,l as C,N as J,p as Q,M as W}from"./index-oR0mlNqp.js";import{a as N}from"./role-BUKAsSP8.js";const X={class:"w-full"},Y={class:"tree-container"},Z={__name:"dataPermission",emits:["success"],setup($,{expose:w,emit:B}){const r=u(!1),v=u(!0),h=u([]),m=u([]),_=u(!1),i=u(),o=u({name:void 0,code:void 0,data_scope:1}),D=u([{value:1,label:"全部数据权限"},{value:2,label:"自定义数据权限"},{value:3,label:"本部门数据权限"},{value:4,label:"本部门及以下数据权限"},{value:5,label:"本人数据权限"}]),L=B,U=async e=>{r.value=!0,o.value={id:e.id,name:e.name,code:e.code,data_scope:e.data_scope},V(!1),y(!1),f(!1),await P(e.id)},V=e=>{i.value.saTree.expandAll(e)},y=e=>{i.value.saTree.checkAll(e)},f=e=>{_.value=e},T=e=>{const a=i.value.saTree,c=a.getExpandedNodes().map(n=>n.id);a.expandNode(e,!c.includes(e[0]))},P=async e=>{v.value=!0;const a=await Q.commonGet("/core/dept/index?tree=true&auth=true");h.value=a.data;const c=await N.getDeptByRole(e);m.value=c.data.depts.map(n=>n.id),m.value.length>0&&f(!0),v.value=!1},A=async e=>{const c=i.value.saTree.getCheckedNodes().map(k=>k.id),n=await N.updateDataPermission(o.value.id,{data_scope:o.value.data_scope,dept_ids:c});n.code===200&&W.success(n.message),L("success"),e(!0)},E=()=>r.value=!1;return w({open:U}),(e,a)=>{const c=d("a-input"),n=d("a-form-item"),k=d("a-option"),R=d("a-select"),b=d("a-checkbox"),S=d("a-space"),F=d("sa-tree-slider"),K=d("a-spin"),M=d("a-form"),z=d("a-modal");return g(),x(z,{visible:r.value,"onUpdate:visible":a[5]||(a[5]=l=>r.value=l),onCancel:E,onBeforeOk:A},{title:t(()=>[p("数据权限")]),default:t(()=>[s(M,{model:o.value},{default:t(()=>[s(n,{label:"角色名称",field:"name"},{default:t(()=>[s(c,{disabled:"",modelValue:o.value.name,"onUpdate:modelValue":a[0]||(a[0]=l=>o.value.name=l)},null,8,["modelValue"])]),_:1}),s(n,{label:"角色标识",field:"code"},{default:t(()=>[s(c,{disabled:"",modelValue:o.value.code,"onUpdate:modelValue":a[1]||(a[1]=l=>o.value.code=l)},null,8,["modelValue"])]),_:1}),s(n,{label:"数据边界",field:"data_scope"},{default:t(()=>[s(R,{modelValue:o.value.data_scope,"onUpdate:modelValue":a[2]||(a[2]=l=>o.value.data_scope=l)},{default:t(()=>[(g(!0),I(O,null,j(D.value,l=>(g(),x(k,{key:l,value:l.value},{default:t(()=>[p(q(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),H(s(n,{label:"部门列表",field:"dept_ids"},{default:t(()=>[s(K,{loading:v.value,tip:"部门加载中...",class:"w-full"},{default:t(()=>[C("div",X,[s(S,{class:"mt-1.5",size:"large"},{default:t(()=>[s(b,{onChange:V},{default:t(()=>[p("展开/折叠")]),_:1}),s(b,{onChange:y},{default:t(()=>[p("全选/全不选")]),_:1}),s(b,{modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=l=>_.value=l),onChange:f},{default:t(()=>[p("关闭父子级联动")]),_:1},8,["modelValue"])]),_:1}),C("div",Y,[s(F,{ref_key:"tree",ref:i,data:h.value,checkable:"",fieldNames:{title:"label",key:"id"},searchPlaceholder:"过滤部门","checked-keys":m.value,"onUpdate:checkedKeys":a[4]||(a[4]=l=>m.value=l),"check-strictly":_.value,"virtual-list-props":{height:300},onClick:T},null,8,["data","checked-keys","check-strictly"])])])]),_:1},8,["loading"])]),_:1},512),[[J,o.value.data_scope=="2"]])]),_:1},8,["model"])]),_:1},8,["visible"])}}},le=G(Z,[["__scopeId","data-v-0361f8d0"]]);export{le as default};
